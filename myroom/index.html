<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <style type="text/css">
        html, body {
          width: 100%;
          height: 100%;
          overflow: hidden;
          margin: 0;
        }
        #renderCanvas {
          width   : 100%;
          height  : 100%;
          touch-action: none;
        }
    </style>
  </head>
  <body>
    <canvas id="renderCanvas"></canvas>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylon.gridMaterial.js"></script>
    <script src="https://code.jquery.com/pep/0.4.1/pep.js"></script>
    <script type="text/javascript">

      function main() {
        const canvas = document.getElementById('renderCanvas');
        const engine = new BABYLON.Engine(canvas);

        var createScene = function() {
          var scene = new BABYLON.Scene(engine);
	
          var light1 = new BABYLON.HemisphericLight("DirectionalLight", new BABYLON.Vector3(0, -1, 0), scene);
          var light2 = new BABYLON.HemisphericLight("HemiLight", new BABYLON.Vector3(0, 1, -1), scene);   
          light1.intensity =1;
          light2.intensity =1; 

          var frameRate = 20;

          /*********performers*********/
          //camera
          var camera = new BABYLON.UniversalCamera("UniversalCamera", new BABYLON.Vector3(0, 3, -30), scene);
          
          // const camera = new BABYLON.ArcRotateCamera("Camera", 0, 0, 0, BABYLON.Vector3.Zero(), scene);
          // camera.position = new BABYLON.Vector3(100, 50, 75);
          // camera.setTarget(new BABYLON.Vector3(80/2, 0, 23/2));          
          
          camera.attachControl(canvas, true);
          
          //door
          const door_texture = new BABYLON.StandardMaterial("");
          door_texture.diffuseTexture = new BABYLON.Texture("texture/door.png");

          var door =  BABYLON.MeshBuilder.CreateBox("door", {width:2, height:4, depth:0.2}, scene);
          var hinge = BABYLON.MeshBuilder.CreateBox("hinge", {}, scene)
          hinge.isVisible = false;
          door.parent = hinge;
          hinge.position.y = 2;
          door.position.x = -1;

          door.material = door_texture;          

          const door_texture_big = new BABYLON.StandardMaterial("");
          door_texture_big.diffuseTexture = new BABYLON.Texture("texture/door.png");
          door_texture_big.diffuseTexture.uScale = 2;
          door_texture_big.diffuseTexture.vScale = 1;  

          var door2 =  BABYLON.MeshBuilder.CreateBox("door", {width:4, height:4, depth:0.2}, scene);
          door2.rotation.y = Math.PI/2;
          door2.position.x = -3.65;
          door2.position.y = 2;
          door2.position.z = 19;

          var door3 = door2.clone();
          door3.position.z = 29;

          door2.material = door3.material =door_texture_big;

          const door_texture_mdl = new BABYLON.StandardMaterial("");
          door_texture_mdl.diffuseTexture = new BABYLON.Texture("texture/door.png");

          var door4 =  BABYLON.MeshBuilder.CreateBox("door", {width:2, height:4, depth:0.2}, scene);
          door4.rotation.y = Math.PI/2;
          door4.position.x = -3.65;
          door4.position.y = 2;
          door4.position.z = 10;

          var door5 = door4.clone();
          door5.position.z = 6;

          var door6 = door5.clone();
          door6.rotation.y = -Math.PI;
          door6.position.x = -9.5;
          door6.position.z = 8;


          door4.material = door5.material = door6.material = door_texture_mdl;
          
          //lights

          //light positions
          // var sphereLight = BABYLON.MeshBuilder.CreateSphere("sphere", {diameter: 0.2}, scene);
          // sphereLight.material = new BABYLON.StandardMaterial("", scene);
          // sphereLight.material.emissiveColor = new BABYLON.Color3(1, 1, 1);
          // sphereLight.position.x = 2;
          // sphereLight.position.y = 3;
          // sphereLight.position.z = 0.1;

          // sphereLights = [sphereLight];
          // lightPositions = [-2, 3, 6.9]

          for(var i = 0; i < 1; i++) {

          //     sphereLights.push(sphereLight.clone(""));
          //     sphereLights[i + 1].position = new BABYLON.Vector3(lightPositions[3*i], lightPositions[3*i + 1], lightPositions[3*i + 2])
          
          // var spotLights = [];
          // var lightDirections = [-0.5, -0.25, 1, 0, 0, -1]
          // for(var i = 0; i < sphereLights.length; i++) {
          //   spotLights[i] = new BABYLON.SpotLight("spotlight" + i, sphereLights[i].position, new BABYLON.Vector3(lightDirections[3*i], lightDirections[3*i + 1], lightDirections[3*i + 2]), Math.PI / 8, 5, scene);
          //   spotLights[i].diffuse = new BABYLON.Color3(1, 1, 1);
          //   spotLights[i].specular = new BABYLON.Color3(0.5, 0.5, 0.5);
          //   spotLights[i].intensity = 0;
          // }

          /*********animations*************/
          // for camera to sweep round
          var rotate = new BABYLON.Animation("rotate", "rotation.y", frameRate, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);
          
          var rotate_keys = []; 

            rotate_keys.push({
                frame: 0,
                value: 0
            });

            rotate_keys.push({
                frame: 9 * frameRate,
                value: 0
            });

            rotate_keys.push({
                frame: 14 * frameRate,
                value: Math. PI
            });

            rotate.setKeys(rotate_keys);
          
            //for camera move forward
            var movein = new BABYLON.Animation("movein", "position", frameRate, BABYLON.Animation.ANIMATIONTYPE_VECTOR3, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);
            
            var movein_keys = []; 

            movein_keys.push({
                frame: 0,
                value: new BABYLON.Vector3(0, 5, -30)
            });

            movein_keys.push({
                frame: 3 * frameRate,
                value: new BABYLON.Vector3(0, 2, -10)
            });

            movein_keys.push({
                frame: 5 * frameRate,
                value: new BABYLON.Vector3(0, 2, -10)
            });

            movein_keys.push({
                frame: 8 * frameRate,
                value: new BABYLON.Vector3(-2, 2, 20)
            });

            movein.setKeys(movein_keys);

          
            //for door to open and close
            var sweep = new BABYLON.Animation("sweep", "rotation.y", frameRate, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);

            var sweep_keys = []; 

            sweep_keys.push({
                frame: 0,
                value: 0
            });

            sweep_keys.push({
                frame: 3 * frameRate,
                value: 0
            });

            sweep_keys.push({
                frame: 5 * frameRate,
                value: Math.PI/3
            });

            sweep_keys.push({
                frame: 13 * frameRate,
                value: Math.PI/3
            });

            sweep_keys.push({
                frame: 15 * frameRate,
                value: 0
            });

            sweep.setKeys(sweep_keys);
          
            /*******Run Clips**********/

            scene.beginDirectAnimation(camera, [movein, rotate], 0, 25 * frameRate, false);
            scene.beginDirectAnimation(hinge, [sweep], 0, 25 * frameRate, false);

            /**************Peripherals of Scene***************/
            const floor_texture = new BABYLON.StandardMaterial("");
            floor_texture.diffuseTexture = new BABYLON.Texture("texture/floor.jpg");
            floor_texture.diffuseTexture.uScale = 3;
            floor_texture.diffuseTexture.vScale = 3;            

            const cross_material = new BABYLON.StandardMaterial("");
            cross_texture = new BABYLON.Texture("texture/cross.jpg");
            cross_material.diffuseTexture = cross_texture;
            cross_material.diffuseTexture.uScale = 2;
            cross_material.diffuseTexture.vScale = 2;


            const cross_material_big = new BABYLON.StandardMaterial("");
            cross_texture_big = new BABYLON.Texture("texture/cross.jpg");
            cross_material_big.diffuseTexture = cross_texture_big;
            cross_material_big.diffuseTexture.uScale = 8;
            cross_material_big.diffuseTexture.vScale = 8;

            const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:30, height:60}, scene);
            ground.position.z = 10;
          

            // outer wall
            const wall1 = BABYLON.MeshBuilder.CreateBox("cross", {width:9, height:6, depth:0.2}, scene);
            wall1.position.x = -6.5;
            wall1.position.y = 3;

            const wall2 = BABYLON.MeshBuilder.CreateBox("cross", {width:9, height:6, depth:0.2}, scene);
            wall2.position.x = 4.5;
            wall2.position.y = 3;

            const wall3 = BABYLON.MeshBuilder.CreateBox("cross", {width:2, height:2, depth:0.2}, scene);
            wall3.position.x = -1;
            wall3.position.y = 5;

            const wall4 = BABYLON.MeshBuilder.CreateBox("cross", {width:20, height:6, depth:0.2}, scene);
            wall4.position.x = -1;
            wall4.position.y = 3;
            wall4.position.z = 36;

            const wall5 = BABYLON.MeshBuilder.CreateBox("cross", {width:36, height:6, depth:0.2}, scene);
            wall5.rotation.y = Math.PI/2;
            wall5.position.x = -11;
            wall5.position.y = 3;
            wall5.position.z = 18;

            const wall6 = wall5.clone();
            wall6.rotation.y = Math.PI/2;
            wall6.position.x = 9;
            wall6.position.y = 3;
            wall6.position.z = 18;

            //inner wall
            const wall7 = BABYLON.MeshBuilder.CreateBox("cross", {width:7.2, height:6, depth:0.2}, scene);
            wall7.position.x = -7.5;
            wall7.position.y = 3;
            wall7.position.z = 22;

            const wall8 = BABYLON.MeshBuilder.CreateBox("cross", {width:4.9, height:6, depth:0.2}, scene);
            wall8.position.x = -6;
            wall8.position.y = 3;
            wall8.position.z = 8;

            const wall9 = BABYLON.MeshBuilder.CreateBox("cross", {width:.5, height:6, depth:0.2}, scene);
            wall9.position.x = -10.8;
            wall9.position.y = 3;
            wall9.position.z = 8;

            const wall10 = BABYLON.MeshBuilder.CreateBox("cross", {width:7.2, height:6, depth:3}, scene);
            wall10.position.x = -7.5;
            wall10.position.y = 3;
            wall10.position.z = 1.5;

            const wall11 = BABYLON.MeshBuilder.CreateBox("cross", {width:5, height:6, depth:0.2}, scene);
            wall11.rotation.y = Math.PI/2;
            wall11.position.x = -3.65;
            wall11.position.y = 3;
            wall11.position.z = 2.5;

            const wall12 = BABYLON.MeshBuilder.CreateBox("cross", {width:2, height:6, depth:0.2}, scene);
            wall12.rotation.y = Math.PI/2;
            wall12.position.x = -3.65;
            wall12.position.y = 3;
            wall12.position.z = 8;

            const wall13 = BABYLON.MeshBuilder.CreateBox("cross", {width:6, height:6, depth:0.2}, scene);
            wall13.rotation.y = Math.PI/2;
            wall13.position.x = -3.65;
            wall13.position.y = 3;
            wall13.position.z = 14;

            const wall14 = wall13.clone();
            wall14.position.z = 24;

            const wall15 = BABYLON.MeshBuilder.CreateBox("cross", {width:5, height:6, depth:0.2}, scene);
            wall15.rotation.y = Math.PI/2;
            wall15.position.x = -3.65;
            wall15.position.y = 3;
            wall15.position.z = 33.5;

            const wall16 = wall11.clone();
            wall16.position.x = -7;
            wall16.position.z = 5;

            // ceiling
            const roof = BABYLON.MeshBuilder.CreateBox("cross", {width:20, height:36, depth:0.2}, scene);
            roof.rotation.x = Math.PI/2;
            roof.position.x = -1;
            roof.position.y = 6;
            roof.position.z = 18;
            
            roof.material = cross_material_big;

            ground.material = floor_texture;

            wall3.material = cross_material;  
            wall1.material = wall2.material = wall4.material = wall5.material = wall6.material = wall7.material = wall8.material = wall9.material = wall10.material = wall11.material = wall12.material = wall13.material = wall14.material = wall15.material = wall16.material = cross_material_big;

            


            }

            return scene;
        };
        
        const scene = createScene();
        
        engine.runRenderLoop(() => {
          scene.render();
        });
        
        window.addEventListener('resize', () => {
          engine.resize();
        });
      }
      window.addEventListener('DOMContentLoaded', main);
    </script>
  </body>
</html>
